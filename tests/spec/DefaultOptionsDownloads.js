'use strict';

describe("Downloads with default options", function () {

	var options = {
		"overrideDlDialog": true,
		"playMediaInBrowser": true,
		"dlListSize": "20",
		"grabFilesLargerThanMB": "0",
		"excludeWebFiles": true,
		"excludedExts": "",
		"includedExts": "",
		"forcedExts": "",
		"blacklistDomains": "",
		"defaultDM": ""
	}

	var app = new DlGrabApp([]);
	app.applyOptions(options);
	app.runtime.blacklist = [];

	function req(dlInfo){
		let handler = new RequestHandling(app);
		handler.performAction = function (download, app) {
			return download.act;
		}
		let info = JSON.parse(dlInfo);
		let reqDetails = info.reqDetails;
		let resDetails = info.resDetails;
		handler.doOnBeforeRequest(reqDetails, app);
		handler.doOnBeforeSendHeaders(reqDetails, app);
		return handler.doOnHeadersReceived(resDetails, app, handler);
	};

	describe("direct known file type", function () {
		let dlInfo = '{"reqDetails":{"requestId":"7016","url":"https://dlgrab.my.to/sample_files/2m.bin","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591371570380,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"dlgrab.my.to"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate, br"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"https://dlgrab.my.to/sample_files/"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"7016","url":"https://dlgrab.my.to/sample_files/2m.bin","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591371571254,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Date","value":"Fri, 05 Jun 2020 15:39:30 GMT"},{"name":"Server","value":"Apache/2.4.18 (Ubuntu)"},{"name":"Last-Modified","value":"Fri, 05 Jun 2020 14:13:29 GMT"},{"name":"ETag","value":"\\"200000-5a756dd88ed42\\""},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-Length","value":"2097152"},{"name":"Keep-Alive","value":"timeout=5, max=100"},{"name":"Connection","value":"Keep-Alive"},{"name":"Content-Type","value":"application/octet-stream"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"198.143.182.183","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB);
		});
	});

	describe("direct unknown file type", function () {
		let dlInfo = '{"reqDetails":{"requestId":"7017","url":"https://dlgrab.my.to/sample_files/2m.asdf","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591371574137,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"dlgrab.my.to"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate, br"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"https://dlgrab.my.to/sample_files/"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"7017","url":"https://dlgrab.my.to/sample_files/2m.asdf","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591371575010,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Date","value":"Fri, 05 Jun 2020 15:39:34 GMT"},{"name":"Server","value":"Apache/2.4.18 (Ubuntu)"},{"name":"Last-Modified","value":"Fri, 05 Jun 2020 14:13:29 GMT"},{"name":"ETag","value":"\\"200000-5a756dd86bac2\\""},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-Length","value":"2097152"},{"name":"Keep-Alive","value":"timeout=5, max=100"},{"name":"Connection","value":"Keep-Alive"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"198.143.182.183","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB);		
		});
	});

	describe("direct script", function () {
		let dlInfo = '{"reqDetails":{"requestId":"9150","url":"https://dlgrab.my.to/sample_files/classes.js","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591377140887,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"dlgrab.my.to"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate, br"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"https://dlgrab.my.to/sample_files/"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"9150","url":"https://dlgrab.my.to/sample_files/classes.js","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591377140890,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":true,"responseHeaders":[{"name":"Date","value":"Fri, 05 Jun 2020 16:03:20 GMT"},{"name":"Server","value":"Apache/2.4.18 (Ubuntu)"},{"name":"Last-Modified","value":"Mon, 01 Jun 2020 19:53:34 GMT"},{"name":"Accept-Ranges","value":"bytes"},{"name":"Vary","value":"Accept-Encoding"},{"name":"Content-Encoding","value":"gzip"},{"name":"Content-Length","value":"9003"},{"name":"Content-Type","value":"application/javascript"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is ignored", function () {
			expect(action).toEqual(ReqFilter.ACT_IGNORE);
		});
	});

	describe("direct image", function () {
		let dlInfo = '{"reqDetails":{"requestId":"9137","url":"https://dlgrab.my.to/sample_files/wish.jpg","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591377107005,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"dlgrab.my.to"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate, br"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"https://dlgrab.my.to/sample_files/"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"9137","url":"https://dlgrab.my.to/sample_files/wish.jpg","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591377109093,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Date","value":"Fri, 05 Jun 2020 17:11:49 GMT"},{"name":"Server","value":"Apache/2.4.18 (Ubuntu)"},{"name":"Last-Modified","value":"Fri, 05 Jun 2020 16:00:49 GMT"},{"name":"ETag","value":"\\"df57-5a7585d5eae40\\""},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-Length","value":"57175"},{"name":"Keep-Alive","value":"timeout=5, max=100"},{"name":"Connection","value":"Keep-Alive"},{"name":"Content-Type","value":"image/jpeg"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"198.143.182.183","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is ignored", function () {
			expect(action).toEqual(ReqFilter.ACT_IGNORE);
		});
	});

	describe("direct text", function () {
		let dlInfo = '{"reqDetails":{"requestId":"9163","url":"https://dlgrab.my.to/sample_files/text.txt","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591377205148,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"dlgrab.my.to"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate, br"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"https://dlgrab.my.to/sample_files/"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"9163","url":"https://dlgrab.my.to/sample_files/text.txt","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591377206523,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Date","value":"Fri, 05 Jun 2020 17:13:26 GMT"},{"name":"Server","value":"Apache/2.4.18 (Ubuntu)"},{"name":"Last-Modified","value":"Fri, 05 Jun 2020 14:13:31 GMT"},{"name":"ETag","value":"\\"14-5a756dda9467d\\""},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-Length","value":"20"},{"name":"Keep-Alive","value":"timeout=5, max=100"},{"name":"Connection","value":"Keep-Alive"},{"name":"Content-Type","value":"text/plain"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"198.143.182.183","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is silent grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB_SILENT);
		});
	});

	describe("direct pdf", function () {
		let dlInfo = '{"reqDetails":{"requestId":"9175","url":"https://dlgrab.my.to/sample_files/lm317.pdf","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591377280907,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"dlgrab.my.to"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate, br"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"https://dlgrab.my.to/sample_files/"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"9175","url":"https://dlgrab.my.to/sample_files/lm317.pdf","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591377281748,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Date","value":"Fri, 05 Jun 2020 17:14:42 GMT"},{"name":"Server","value":"Apache/2.4.18 (Ubuntu)"},{"name":"Last-Modified","value":"Fri, 05 Jun 2020 14:13:31 GMT"},{"name":"ETag","value":"\\"f70cc-5a756dda8c97e\\""},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-Length","value":"1011916"},{"name":"Keep-Alive","value":"timeout=5, max=100"},{"name":"Connection","value":"Keep-Alive"},{"name":"Content-Type","value":"application/pdf"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"198.143.182.183","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is silent grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB_SILENT);
		});
	});

	describe("direct media", function () {
		let dlInfo = '{"reqDetails":{"requestId":"8623","url":"https://dlgrab.my.to/sample_files/file_example_MP4_480_1_5MG.mp4","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591373242286,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"dlgrab.my.to"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate, br"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"https://dlgrab.my.to/sample_files/"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"8623","url":"https://dlgrab.my.to/sample_files/file_example_MP4_480_1_5MG.mp4","originUrl":"https://dlgrab.my.to/sample_files/","method":"GET","type":"main_frame","timeStamp":1591373243087,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Date","value":"Fri, 05 Jun 2020 16:07:22 GMT"},{"name":"Server","value":"Apache/2.4.18 (Ubuntu)"},{"name":"Last-Modified","value":"Fri, 05 Jun 2020 14:13:30 GMT"},{"name":"ETag","value":"\\"17f4e8-5a756dd9d405f\\""},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-Length","value":"1570024"},{"name":"Keep-Alive","value":"timeout=5, max=100"},{"name":"Connection","value":"Keep-Alive"},{"name":"Content-Type","value":"video/mp4"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"198.143.182.183","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":98,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is silent grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB_SILENT);
		});
	});

	describe("attachment known file type", function () {
		let dlInfo = '{"reqDetails":{"requestId":"8044","url":"https://doc-14-0c-docs.googleusercontent.com/docs/securesc/genfoh9376qgq854klcrhdsoiv6471et/7o6htdbph88tba4e1nd8a8em8r3vpd8s/1591372650000/17062244966882741997/17064401898023832409Z/1_zeJqQP8umrTk-evSAt3wCLxAkTKo0lC?e=download&nonce=0i63si9ssu2r8&user=17064401898023832409Z&hash=811a0n8ofkma9mof2lgmbu520dgb64gc","originUrl":"https://drive.google.com/file/d/1_zeJqQP8umrTk-evSAt3wCLxAkTKo0lC/view","method":"GET","type":"main_frame","timeStamp":1591372691790,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"doc-14-0c-docs.googleusercontent.com"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate, br"},{"name":"Referer","value":"https://drive.google.com/"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Cookie","value":"AUTH_sph2uk2r0h5crjcf3t2hvjmgmnhc2qid_nonce=0i63si9ssu2r8"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":168,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"8044","url":"https://doc-14-0c-docs.googleusercontent.com/docs/securesc/genfoh9376qgq854klcrhdsoiv6471et/7o6htdbph88tba4e1nd8a8em8r3vpd8s/1591372650000/17062244966882741997/17064401898023832409Z/1_zeJqQP8umrTk-evSAt3wCLxAkTKo0lC?e=download&nonce=0i63si9ssu2r8&user=17064401898023832409Z&hash=811a0n8ofkma9mof2lgmbu520dgb64gc","originUrl":"https://drive.google.com/file/d/1_zeJqQP8umrTk-evSAt3wCLxAkTKo0lC/view","method":"GET","type":"main_frame","timeStamp":1591372692246,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"x-guploader-uploadid","value":"AAANsUnB9pUtlydTPdBuWLjO8oDhasXvMmwxR9V5g20FTQSSEum00AD6rM-b30js3Ro2o_4hlfLgPkaynrNb6inYUg"},{"name":"access-control-allow-origin","value":"*"},{"name":"access-control-allow-credentials","value":"false"},{"name":"access-control-allow-headers","value":"Accept, Accept-Language, Authorization, Cache-Control, Content-Disposition, Content-Encoding, Content-Language, Content-Length, Content-MD5, Content-Range, Content-Type, Date, GData-Version, google-cloud-resource-prefix, Host, If-Match, If-Modified-Since, If-None-Match, If-Unmodified-Since, Origin, OriginToken, Pragma, Range, Slug, Transfer-Encoding, Want-Digest, x-chrome-connected, X-ClientDetails, X-Client-Version, X-Firebase-Locale, X-Goog-Firebase-Installations-Auth, X-Firebase-Client, X-Firebase-Client-Log-Type, X-GData-Client, X-GData-Key, X-GoogApps-Allowed-Domains, X-Goog-AdX-Buyer-Impersonation, X-Goog-Api-Client, X-Goog-AuthUser, x-goog-ext-124712974-jspb, x-goog-ext-259736195-jspb, X-Goog-PageId, X-Goog-Encode-Response-If-Executable, X-Goog-Correlation-Id, X-Goog-Request-Info, X-Goog-Request-Reason, X-Goog-Experiments, x-goog-iam-authority-selector, x-goog-iam-authorization-token, X-Goog-Spatula, X-Goog-Travel-Bgr, X-Goog-Travel-Settings, X-Goog-Upload-Command, X-Goog-Upload-Content-Disposition, X-Goog-Upload-Content-Length, X-Goog-Upload-Content-Type, X-Goog-Upload-File-Name, X-Goog-Upload-Header-Content-Length, X-Goog-Upload-Offset, X-Goog-Upload-Protocol, x-goog-user-project, X-Goog-Visitor-Id, X-Goog-FieldMask, X-Google-Project-Override, X-Goog-Api-Key, X-HTTP-Method-Override, X-JavaScript-User-Agent, X-Pan-Versionid, X-Proxied-User-IP, X-Origin, X-Referer, X-Requested-With, X-Stadia-Client-Context, X-Upload-Content-Length, X-Upload-Content-Type, X-Use-HTTP-Status-Code-Override, X-Ios-Bundle-Identifier, X-Android-Package, X-Ariane-Xsrf-Token, X-YouTube-VVT, X-YouTube-Page-CL, X-YouTube-Page-Timestamp, X-Goog-Meeting-Botguardid, X-Goog-Meeting-Debugid, X-Goog-Meeting-Token, X-Client-Data, X-Sfdc-Authorization, MIME-Version, Content-Transfer-Encoding, X-Earth-Engine-App-ID-Token, X-Earth-Engine-Computation-Profile, X-Earth-Engine-Computation-Profiling, X-Play-Console-Experiments-Override, X-Play-Console-Session-Id, x-alkali-account-key, x-alkali-application-key, x-alkali-auth-apps-namespace, x-alkali-auth-entities-namespace, x-alkali-auth-entity, x-alkali-client-locale, EES-S7E-MODE"},{"name":"access-control-allow-methods","value":"GET,OPTIONS"},{"name":"p3p","value":"CP=\\"This is not a P3P policy! See http://www.google.com/support/accounts/answer/151657?hl=en for more info.\\""},{"name":"content-type","value":"application/x-zip-compressed"},{"name":"content-disposition","value":"attachment;filename=\\"Sample file.zip\\";filename*=UTF-8\'\'Sample%20file.zip"},{"name":"date","value":"Fri, 05 Jun 2020 15:58:11 GMT"},{"name":"expires","value":"Fri, 05 Jun 2020 15:58:11 GMT"},{"name":"cache-control","value":"private, max-age=0"},{"name":"x-goog-hash","value":"crc32c=mTjaUQ=="},{"name":"server","value":"UploadServer"},{"name":"set-cookie","value":"AUTH_sph2uk2r0h5crjcf3t2hvjmgmnhc2qid=17064401898023832409Z|1591372650000|9io053schi4p5u6oaqe4l497876k8oca; Domain=.googleusercontent.com; Expires=Fri, 05-Jun-2020 16:03:11 GMT; Path=/docs/securesc/genfoh9376qgq854klcrhdsoiv6471et; Secure; SameSite=none; HttpOnly\\nAUTH_sph2uk2r0h5crjcf3t2hvjmgmnhc2qid_nonce=; Domain=doc-14-0c-docs.googleusercontent.com; Expires=Thu, 04-Jun-2020 15:58:11 GMT; Path=/docs/securesc/genfoh9376qgq854klcrhdsoiv6471et; Secure; SameSite=none; HttpOnly"},{"name":"alt-svc","value":"h3-27=\\":443\\"; ma=2592000,h3-25=\\":443\\"; ma=2592000,h3-T050=\\":443\\"; ma=2592000,h3-Q050=\\":443\\"; ma=2592000,h3-Q049=\\":443\\"; ma=2592000,h3-Q048=\\":443\\"; ma=2592000,h3-Q046=\\":443\\"; ma=2592000,h3-Q043=\\":443\\"; ma=2592000,quic=\\":443\\"; ma=2592000; v=\\"46,43\\""},{"name":"X-Firefox-Spdy","value":"h2"}],"statusCode":200,"statusLine":"HTTP/2.0 200 OK","proxyInfo":null,"ip":"108.177.122.132","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":168,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB);		
		});
	});

	describe("attachment unknown file type", function () {
		let dlInfo = '{"reqDetails":{"requestId":"7989","url":"http://download1484.mediafire.com/u3sj9dcjn0gg/16d9zv60vh8blh9/file.asdf","originUrl":"http://www.mediafire.com/file/16d9zv60vh8blh9/file.asdf","method":"GET","type":"main_frame","timeStamp":1591372479825,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"download1484.mediafire.com"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"http://www.mediafire.com/file/16d9zv60vh8blh9/file.asdf"},{"name":"Cookie","value":"__cfduid=dade43c8917668844725ec90a7c59efd81591372404; ukey=p2mxlbjmx9i2qgb7325rw4ap42sslzmy; currenturl=%2F"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":164,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"7989","url":"http://download1484.mediafire.com/u3sj9dcjn0gg/16d9zv60vh8blh9/file.asdf","originUrl":"http://www.mediafire.com/file/16d9zv60vh8blh9/file.asdf","method":"GET","type":"main_frame","timeStamp":1591372480678,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Server","value":"LRBD-0a25541"},{"name":"Date","value":"Fri, 5 Jun 2020 15:54:40 GMT"},{"name":"Connection","value":"close"},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-transfer-encoding","value":"binary"},{"name":"Content-Length","value":"56348"},{"name":"Cache-Control","value":"no-store"},{"name":"X-Robots-Tag","value":"noindex, nofollow"},{"name":"Content-Disposition","value":"attachment; filename=\\"file.asdf\\""},{"name":"Content-Type","value":"application/zip"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"205.196.123.172","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":164,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB);
		});
	});

	describe("attachment media", function () {
		let dlInfo = '{"reqDetails":{"requestId":"9291","url":"http://download943.mediafire.com/ibvbyzfrffeg/v2saixz7prjdn7h/file_example_MP4_480_1_5MG.mp4","originUrl":"http://www.mediafire.com/file/v2saixz7prjdn7h/file_example_MP4_480_1_5MG.mp4/file","method":"GET","type":"main_frame","timeStamp":1591377415668,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"download943.mediafire.com"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"http://www.mediafire.com/file/v2saixz7prjdn7h/file_example_MP4_480_1_5MG.mp4/file"},{"name":"Cookie","value":"__cfduid=d2aa401b52d824a6b5eeb1fc5a3e3253b1591377393; ukey=iyt52hnx0iy6c8f5u248eypy7xcbz4fs"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":186,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"9291","url":"http://download943.mediafire.com/ibvbyzfrffeg/v2saixz7prjdn7h/file_example_MP4_480_1_5MG.mp4","originUrl":"http://www.mediafire.com/file/v2saixz7prjdn7h/file_example_MP4_480_1_5MG.mp4/file","method":"GET","type":"main_frame","timeStamp":1591377416428,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Server","value":"LRBD-0a25541"},{"name":"Date","value":"Fri, 5 Jun 2020 17:16:56 GMT"},{"name":"Connection","value":"close"},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-transfer-encoding","value":"binary"},{"name":"Content-Length","value":"1570024"},{"name":"Cache-Control","value":"no-store"},{"name":"X-Robots-Tag","value":"noindex, nofollow"},{"name":"Content-Disposition","value":"attachment; filename=\\"file_example_MP4_480_1_5MG.mp4\\""},{"name":"Content-Type","value":"video/mp4"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"205.196.121.138","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":186,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB);
		});
	});

	describe("attachment unknown", function () {
		let dlInfo = '{"reqDetails":{"requestId":"9298","url":"http://download1484.mediafire.com/67xwqhima8pg/16d9zv60vh8blh9/file.asdf","originUrl":"http://www.mediafire.com/file/16d9zv60vh8blh9/file.asdf","method":"GET","type":"main_frame","timeStamp":1591377469525,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"download1484.mediafire.com"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"http://www.mediafire.com/file/16d9zv60vh8blh9/file.asdf"},{"name":"Cookie","value":"__cfduid=d2aa401b52d824a6b5eeb1fc5a3e3253b1591377393; ukey=iyt52hnx0iy6c8f5u248eypy7xcbz4fs"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":187,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"9298","url":"http://download1484.mediafire.com/67xwqhima8pg/16d9zv60vh8blh9/file.asdf","originUrl":"http://www.mediafire.com/file/16d9zv60vh8blh9/file.asdf","method":"GET","type":"main_frame","timeStamp":1591377470356,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Server","value":"LRBD-0a25541"},{"name":"Date","value":"Fri, 5 Jun 2020 17:17:50 GMT"},{"name":"Connection","value":"close"},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-transfer-encoding","value":"binary"},{"name":"Content-Length","value":"56348"},{"name":"Cache-Control","value":"no-store"},{"name":"X-Robots-Tag","value":"noindex, nofollow"},{"name":"Content-Disposition","value":"attachment; filename=\\"file.asdf\\""},{"name":"Content-Type","value":"application/zip"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"205.196.123.172","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":187,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB);
		});
	});

	describe("attachment image", function () {
		let dlInfo = '{"reqDetails":{"requestId":"9301","url":"http://download1075.mediafire.com/95dvceoifyrg/l7gwk9xzaop0dtw/20180731_103122.jpg","originUrl":"http://www.mediafire.com/file/l7gwk9xzaop0dtw/20180731_103122.jpg/file","method":"GET","type":"main_frame","timeStamp":1591377502986,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"download1075.mediafire.com"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"http://www.mediafire.com/file/l7gwk9xzaop0dtw/20180731_103122.jpg/file"},{"name":"Cookie","value":"__cfduid=d2aa401b52d824a6b5eeb1fc5a3e3253b1591377393; ukey=iyt52hnx0iy6c8f5u248eypy7xcbz4fs"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":189,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"9301","url":"http://download1075.mediafire.com/95dvceoifyrg/l7gwk9xzaop0dtw/20180731_103122.jpg","originUrl":"http://www.mediafire.com/file/l7gwk9xzaop0dtw/20180731_103122.jpg/file","method":"GET","type":"main_frame","timeStamp":1591377503806,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Server","value":"LRBD-0a25541"},{"name":"Date","value":"Fri, 5 Jun 2020 17:18:24 GMT"},{"name":"Connection","value":"close"},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-transfer-encoding","value":"binary"},{"name":"Content-Length","value":"141516"},{"name":"Cache-Control","value":"no-store"},{"name":"X-Robots-Tag","value":"noindex, nofollow"},{"name":"Content-Disposition","value":"attachment; filename=\\"20180731_103122.jpg\\""},{"name":"Content-Type","value":"image/jpeg"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"205.196.122.16","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":189,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB);
		});
	});

	describe("attachment script", function () {
		let dlInfo = '{"reqDetails":{"requestId":"9308","url":"http://download1319.mediafire.com/z0y0rijcgszg/a6hkwatvnuzjv0y/classes.js","originUrl":"http://www.mediafire.com/file/a6hkwatvnuzjv0y/classes.js/file","method":"GET","type":"main_frame","timeStamp":1591377541556,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"download1319.mediafire.com"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"http://www.mediafire.com/file/a6hkwatvnuzjv0y/classes.js/file"},{"name":"Cookie","value":"__cfduid=d2aa401b52d824a6b5eeb1fc5a3e3253b1591377393; ukey=iyt52hnx0iy6c8f5u248eypy7xcbz4fs"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":188,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"9308","url":"http://download1319.mediafire.com/z0y0rijcgszg/a6hkwatvnuzjv0y/classes.js","originUrl":"http://www.mediafire.com/file/a6hkwatvnuzjv0y/classes.js/file","method":"GET","type":"main_frame","timeStamp":1591377542432,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Server","value":"LRBD-0a25541"},{"name":"Date","value":"Fri, 5 Jun 2020 17:19:02 GMT"},{"name":"Connection","value":"close"},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-transfer-encoding","value":"binary"},{"name":"Content-Length","value":"33782"},{"name":"Cache-Control","value":"no-store"},{"name":"X-Robots-Tag","value":"noindex, nofollow"},{"name":"Content-Disposition","value":"attachment; filename=\\"classes.js\\""},{"name":"Content-Type","value":"text/javascript"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"205.196.123.7","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":188,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB);
		});
	});

	describe("attachment pdf", function () {
		let dlInfo = '{"reqDetails":{"requestId":"9435","url":"http://download1078.mediafire.com/235pqcx7l4ug/77gqk2jxktms6un/lm317.pdf","originUrl":"http://www.mediafire.com/file/77gqk2jxktms6un/lm317.pdf/file","method":"GET","type":"main_frame","timeStamp":1591377745471,"frameId":0,"parentFrameId":-1,"thirdParty":false,"requestHeaders":[{"name":"Host","value":"download1078.mediafire.com"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0"},{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},{"name":"Accept-Language","value":"en-US,en;q=0.5"},{"name":"Accept-Encoding","value":"gzip, deflate"},{"name":"DNT","value":"1"},{"name":"Connection","value":"keep-alive"},{"name":"Referer","value":"http://www.mediafire.com/file/77gqk2jxktms6un/lm317.pdf/file"},{"name":"Cookie","value":"__cfduid=d2aa401b52d824a6b5eeb1fc5a3e3253b1591377393; ukey=iyt52hnx0iy6c8f5u248eypy7xcbz4fs"},{"name":"Upgrade-Insecure-Requests","value":"1"}],"proxyInfo":null,"ip":null,"frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":196,"incognito":false,"cookieStoreId":"firefox-default","postData":""},"resDetails":{"requestId":"9435","url":"http://download1078.mediafire.com/235pqcx7l4ug/77gqk2jxktms6un/lm317.pdf","originUrl":"http://www.mediafire.com/file/77gqk2jxktms6un/lm317.pdf/file","method":"GET","type":"main_frame","timeStamp":1591377746794,"frameId":0,"parentFrameId":-1,"thirdParty":false,"fromCache":false,"responseHeaders":[{"name":"Server","value":"LRBD-0a25541"},{"name":"Date","value":"Fri, 5 Jun 2020 17:22:27 GMT"},{"name":"Connection","value":"close"},{"name":"Accept-Ranges","value":"bytes"},{"name":"Content-transfer-encoding","value":"binary"},{"name":"Content-Length","value":"1011916"},{"name":"Cache-Control","value":"no-store"},{"name":"X-Robots-Tag","value":"noindex, nofollow"},{"name":"Content-Disposition","value":"attachment; filename=\\"lm317.pdf\\""},{"name":"Content-Type","value":"application/pdf"}],"statusCode":200,"statusLine":"HTTP/1.1 200 OK","proxyInfo":null,"ip":"205.196.122.19","frameAncestors":[],"urlClassification":{"firstParty":[],"thirdParty":[]},"requestSize":0,"responseSize":0,"tabId":196,"incognito":false,"cookieStoreId":"firefox-default"}}';
		let action = req(dlInfo);
		it("is grabbed", function () {
			expect(action).toEqual(ReqFilter.ACT_GRAB);
		});
	});

});